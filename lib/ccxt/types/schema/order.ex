defmodule CCXT.Types.Schema.Order do
  @moduledoc """
  Auto-generated schema for `CCXT.Types.Order`.

  Source: priv/ccxt/ts/src/base/types.ts

  ## Fields

  - `id` - Exchange-assigned order identifier. String.t()
  - `client_order_id` - Client-specified order identifier. String.t() | nil
  - `datetime` - ISO 8601 datetime of order creation. String.t()
  - `timestamp` - Unix timestamp of order creation in milliseconds. number()
  - `last_trade_timestamp` - Timestamp of the last trade for this order. number()
  - `last_update_timestamp` - Timestamp of the last status update. number() (optional)
  - `status` - Order status: "open", "closed", or "canceled". String.t() | nil
  - `symbol` - Trading pair identifier (e.g. "BTC/USDT"). String.t()
  - `type` - Order type: "limit", "market", etc. String.t() | nil
  - `time_in_force` - Time in force: "GTC", "IOC", "FOK", "PO". String.t() | nil (optional)
  - `side` - Order side: "buy" or "sell". String.t() | nil
  - `price` - Limit price for the order. number()
  - `average` - Average fill price across all trades. number() (optional)
  - `amount` - Total order quantity in base currency. number()
  - `filled` - Filled quantity in base currency. number()
  - `remaining` - Remaining unfilled quantity in base currency. number()
  - `stop_price` - Stop/trigger price for conditional orders. number() (optional)
  - `trigger_price` - Trigger price (alias for stop_price on some exchanges). number() (optional)
  - `take_profit_price` - Take-profit price for TP/SL orders. number() (optional)
  - `stop_loss_price` - Stop-loss price for TP/SL orders. number() (optional)
  - `cost` - Total cost of filled portion (filled * average price). number()
  - `trades` - List of individual trade fills for this order. [CCXT.Types.Trade.t()]
  - `fee` - Fee charged for this order. CCXT.Types.FeeInterface.t() | nil
  - `reduce_only` - Whether the order can only reduce a position. boolean() | nil
  - `post_only` - Whether the order must be a maker order. boolean() | nil
  - `raw` - Raw exchange response data. any()

  ## Usage

  This module is used by `CCXT.Types.Order`:

      defmodule CCXT.Types.Order do
        use CCXT.Types.Schema.Order
      end

  Do not edit this file manually - it will be overwritten by `mix ccxt.gen.types`.

  """

  Module.register_attribute(__MODULE__, :fields, persist: true)

  @fields [
    %{name: :id, optional: false, source: "id", type: "String.t()"},
    %{name: :client_order_id, optional: false, source: "clientOrderId", type: "String.t() | nil"},
    %{name: :datetime, optional: false, source: "datetime", type: "String.t()"},
    %{name: :timestamp, optional: false, source: "timestamp", type: "number()"},
    %{name: :last_trade_timestamp, optional: false, source: "lastTradeTimestamp", type: "number()"},
    %{
      name: :last_update_timestamp,
      optional: true,
      source: "lastUpdateTimestamp",
      type: "number()"
    },
    %{name: :status, optional: false, source: "status", type: "String.t() | nil"},
    %{name: :symbol, optional: false, source: "symbol", type: "String.t()"},
    %{name: :type, optional: false, source: "type", type: "String.t() | nil"},
    %{name: :time_in_force, optional: true, source: "timeInForce", type: "String.t() | nil"},
    %{name: :side, optional: false, source: "side", type: "String.t() | nil"},
    %{name: :price, optional: false, source: "price", type: "number()"},
    %{name: :average, optional: true, source: "average", type: "number()"},
    %{name: :amount, optional: false, source: "amount", type: "number()"},
    %{name: :filled, optional: false, source: "filled", type: "number()"},
    %{name: :remaining, optional: false, source: "remaining", type: "number()"},
    %{name: :stop_price, optional: true, source: "stopPrice", type: "number()"},
    %{name: :trigger_price, optional: true, source: "triggerPrice", type: "number()"},
    %{name: :take_profit_price, optional: true, source: "takeProfitPrice", type: "number()"},
    %{name: :stop_loss_price, optional: true, source: "stopLossPrice", type: "number()"},
    %{name: :cost, optional: false, source: "cost", type: "number()"},
    %{name: :trades, optional: false, source: "trades", type: "[CCXT.Types.Trade.t()]"},
    %{name: :fee, optional: false, source: "fee", type: "CCXT.Types.FeeInterface.t() | nil"},
    %{name: :reduce_only, optional: false, source: "reduceOnly", type: "boolean() | nil"},
    %{name: :post_only, optional: false, source: "postOnly", type: "boolean() | nil"},
    %{name: :raw, optional: false, source: "info", type: "any()"}
  ]
  @type_spec_str """
  %__MODULE__{
    id: String.t(),
    client_order_id: String.t() | nil,
    datetime: String.t(),
    timestamp: number(),
    last_trade_timestamp: number(),
    last_update_timestamp: number() | nil,
    status: String.t() | nil,
    symbol: String.t(),
    type: String.t() | nil,
    time_in_force: String.t() | nil,
    side: String.t() | nil,
    price: number(),
    average: number() | nil,
    amount: number(),
    filled: number(),
    remaining: number(),
    stop_price: number() | nil,
    trigger_price: number() | nil,
    take_profit_price: number() | nil,
    stop_loss_price: number() | nil,
    cost: number(),
    trades: [CCXT.Types.Trade.t()],
    fee: CCXT.Types.FeeInterface.t() | nil,
    reduce_only: boolean() | nil,
    post_only: boolean() | nil,
    raw: any()
  }
  """
  @type_spec Code.string_to_quoted!(@type_spec_str)

  defmacro __using__(opts) do
    fields = @fields
    type_spec = @type_spec
    struct_defaults = Keyword.get(opts, :struct_defaults, [])
    field_names = Enum.map(fields, & &1.name)

    struct_fields =
      Enum.map(field_names, fn name ->
        if Keyword.has_key?(struct_defaults, name) do
          {name, Keyword.fetch!(struct_defaults, name)}
        else
          name
        end
      end)

    quote do
      import CCXT.Types.Helpers, only: [get_value: 2, get_camel_value: 3]

      @fields unquote(Macro.escape(fields))
      @type_spec unquote(Macro.escape(type_spec))
      @type t :: unquote(type_spec)
      defstruct unquote(struct_fields)
      @spec from_map(map()) :: t()
      def from_map(map) when is_map(map) do
        %__MODULE__{
          id: get_value(map, :id),
          client_order_id: get_camel_value(map, :client_order_id, :clientOrderId),
          datetime: get_value(map, :datetime),
          timestamp: get_value(map, :timestamp),
          last_trade_timestamp: get_camel_value(map, :last_trade_timestamp, :lastTradeTimestamp),
          last_update_timestamp: get_camel_value(map, :last_update_timestamp, :lastUpdateTimestamp),
          status: get_value(map, :status),
          symbol: get_value(map, :symbol),
          type: get_value(map, :type),
          time_in_force: get_camel_value(map, :time_in_force, :timeInForce),
          side: get_value(map, :side),
          price: get_value(map, :price),
          average: get_value(map, :average),
          amount: get_value(map, :amount),
          filled: get_value(map, :filled),
          remaining: get_value(map, :remaining),
          stop_price: get_camel_value(map, :stop_price, :stopPrice),
          trigger_price: get_camel_value(map, :trigger_price, :triggerPrice),
          take_profit_price: get_camel_value(map, :take_profit_price, :takeProfitPrice),
          stop_loss_price: get_camel_value(map, :stop_loss_price, :stopLossPrice),
          cost: get_value(map, :cost),
          trades: get_value(map, :trades),
          fee: get_value(map, :fee),
          reduce_only: get_camel_value(map, :reduce_only, :reduceOnly),
          post_only: get_camel_value(map, :post_only, :postOnly),
          raw: get_camel_value(map, :raw, :info)
        }
      end

      defoverridable from_map: 1
    end
  end
end
